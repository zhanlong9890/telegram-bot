# 🚀 云端部署步骤（Railway）

## 📋 部署前准备

### 1. 确保代码已推送到 GitHub

如果还没有，请执行：

```bash
# 初始化 Git（如果还没有）
git init

# 添加所有文件
git add .

# 提交
git commit -m "Initial commit"

# 在 GitHub 创建新仓库，然后推送
git remote add origin https://github.com/你的用户名/你的仓库名.git
git branch -M main
git push -u origin main
```

### 2. 准备机器人 Token

- 从 [@BotFather](https://t.me/BotFather) 获取你的机器人 Token
- 格式：`123456789:ABCdefGHIjklMNOpqrsTUVwxyz`

---

## 🎯 Railway 部署（推荐）

### 步骤 1：注册 Railway

1. 访问 [https://railway.app](https://railway.app)
2. 点击右上角 **"Login"** 或 **"Start a New Project"**
3. 选择 **"Login with GitHub"**
4. 授权 Railway 访问你的 GitHub 账号

### 步骤 2：创建新项目

1. 登录后，点击 **"New Project"**
2. 选择 **"Deploy from GitHub repo"**
3. 在列表中选择你的代码仓库
4. 点击 **"Deploy Now"**

### 步骤 3：配置环境变量

1. 在项目页面，点击 **"Variables"** 标签
2. 点击 **"+ New Variable"** 添加环境变量：

   **必需变量：**
   ```
   BOT_TOKEN = 你的机器人Token（例如：8468223563:AAGwZNfTT97sGhXaqba9ZBb-w1OznieV67k）
   ```

   **可选变量：**
   ```
   ADMIN_IDS = 你的用户ID（多个用逗号分隔，例如：123456789,987654321）
   ```

3. 点击 **"Add"** 保存每个变量

### 步骤 4：等待部署

- Railway 会自动：
  1. 检测 `requirements.txt` 并安装依赖
  2. 运行 `python bot.py` 启动机器人
  3. 显示部署日志

### 步骤 5：查看日志

1. 点击项目页面上的部署卡片
2. 点击 **"View Logs"** 查看实时日志
3. 如果看到 `机器人启动中...` 说明部署成功

### 步骤 6：测试机器人

1. 在 Telegram 中找到你的机器人
2. 发送 `/start` 命令
3. 如果机器人回复，说明部署成功！

---

## 🔧 其他平台部署

### Render 部署

1. 访问 [https://render.com](https://render.com)
2. 注册并连接 GitHub
3. 创建 **"Web Service"**
4. 选择你的仓库
5. 配置：
   - **Build Command**: `pip install -r requirements.txt`
   - **Start Command**: `python bot.py`
6. 添加环境变量 `BOT_TOKEN`
7. 点击 **"Create Web Service"**

⚠️ **注意**：Render 免费版会在 15 分钟无活动后休眠，首次请求需要等待 30-60 秒唤醒。

### Fly.io 部署

1. 安装 Fly CLI：
   ```bash
   # Windows (PowerShell)
   iwr https://fly.io/install.ps1 -useb | iex
   ```

2. 注册并登录：
   ```bash
   fly auth signup
   fly auth login
   ```

3. 创建应用：
   ```bash
   fly launch
   ```

4. 设置环境变量：
   ```bash
   fly secrets set BOT_TOKEN=你的机器人Token
   ```

5. 部署：
   ```bash
   fly deploy
   ```

---

## ✅ 部署检查清单

- [ ] 代码已推送到 GitHub
- [ ] `requirements.txt` 文件存在
- [ ] `bot.py` 是主程序文件
- [ ] 环境变量 `BOT_TOKEN` 已配置
- [ ] 部署日志显示 "机器人启动中..."
- [ ] 测试 `/start` 命令成功

---

## 🐛 常见问题

### 问题 1：机器人不响应

**解决**：
1. 检查 `BOT_TOKEN` 是否正确
2. 查看部署日志是否有错误
3. 确认机器人已启动（日志中看到 "机器人启动中..."）

### 问题 2：导入错误

**解决**：
1. 确认 `requirements.txt` 包含所有依赖
2. 检查 Python 版本（Railway 自动使用 Python 3.11）

### 问题 3：环境变量未生效

**解决**：
1. 确认在平台正确配置了环境变量
2. 重启服务（Railway 会自动重启）

### 问题 4：部署失败

**解决**：
1. 查看部署日志中的错误信息
2. 确认 `bot.py` 文件存在且正确
3. 确认 `requirements.txt` 格式正确

---

## 📊 查看运行状态

### Railway
- 项目页面显示部署状态
- 点击部署卡片查看日志
- 绿色表示运行中，红色表示错误

### 测试机器人
- 在 Telegram 中发送 `/start`
- 如果收到回复，说明运行正常

---

## 💰 费用说明

### Railway
- **免费额度**：每月 $5
- **使用量**：机器人运行约 $0.01/小时
- **每月可用**：约 500 小时（足够 24/7 运行）

### Render
- **免费套餐**：完全免费
- **限制**：15 分钟无活动会休眠

### Fly.io
- **免费额度**：3 个共享 CPU 虚拟机
- **流量**：160GB 出站流量/月

---

## 🎉 部署完成！

部署成功后，你的机器人将：
- ✅ 24/7 运行，无需保持电脑开机
- ✅ 自动重启（崩溃时）
- ✅ 自动更新（GitHub 推送时）

**享受你的云端机器人吧！** 🚀

