# 积分系统使用说明

## 🎯 功能概述

积分系统可以激励群成员活跃发言，管理员可以通过积分来奖励优秀成员。

## 💰 积分获取方式

### 自动获取
- **发言奖励**：在群组中发送消息自动获得 1 积分
- **冷却时间**：60秒内只能获得一次积分（防止刷分）
- **自动记录**：所有积分变化都会记录到数据库

### 管理员奖励
- 管理员可以使用 `/addpoints` 给用户添加积分
- 可以设置原因，方便记录

## 📊 积分命令

### 普通用户命令

#### `/points` - 查看自己的积分
```
/points
```
显示：
- 当前积分
- 排名
- 提示信息

#### `/top` - 查看积分排行榜
```
/top
```
显示前10名用户的积分排名，带奖牌显示 🥇🥈🥉

### 管理员命令

#### `/addpoints <数量> [原因]` - 添加积分
```
/addpoints 100 优秀贡献
```
- 回复要奖励的用户消息
- 添加指定数量的积分
- 可选原因说明

#### `/removepoints <数量> [原因]` - 扣除积分
```
/removepoints 50 违规行为
```
- 回复要扣除积分的用户消息
- 扣除指定数量的积分
- 可选原因说明

#### `/setpoints <数量>` - 设置积分
```
/setpoints 1000
```
- 回复要设置积分的用户消息
- 直接设置积分值（覆盖原有积分）

#### `/points` - 查看用户积分（管理员）
```
/points
```
- 回复用户消息
- 查看该用户的积分和排名

## 🛡️ 防刷分机制

1. **时间冷却**：60秒内只能获得一次积分
2. **消息检测**：只计算真实消息，忽略命令和机器人消息
3. **数据库记录**：所有积分变化都有记录，可追溯

## 💾 数据存储

- **数据库**：SQLite（`bot_data.db`）
- **存储内容**：
  - 用户积分
  - 积分历史记录
  - 警告记录
- **自动备份**：建议定期备份 `bot_data.db` 文件

## 📈 使用场景

### 场景1：激励活跃成员
- 设置积分奖励规则
- 定期查看排行榜
- 给活跃成员额外奖励

### 场景2：惩罚违规行为
- 扣除违规用户的积分
- 积分可以用于排名，低积分用户排名靠后

### 场景3：活动奖励
- 举办活动时给参与者添加积分
- 活动结束后查看排行榜
- 给获奖者额外奖励

## ⚙️ 配置说明

在 `config.py` 中可以配置：
- `MAX_WARN_LIMIT`：最大警告次数（默认3次）

积分相关配置在 `points_system.py` 中：
- `points_per_message`：每条消息获得的积分（默认1分）
- `cooldown`：冷却时间（默认60秒）

## 🔧 故障排查

### 问题1：积分没有增加
- 检查是否在群组中（私聊不计算）
- 检查是否在冷却时间内
- 查看日志确认是否有错误

### 问题2：排行榜为空
- 确认有用户获得过积分
- 检查数据库文件是否存在
- 查看数据库连接是否正常

### 问题3：积分数据丢失
- 检查 `bot_data.db` 文件是否被删除
- 确认数据库文件权限
- 建议定期备份数据库

## 📝 注意事项

1. **数据库备份**：定期备份 `bot_data.db` 文件
2. **权限设置**：确保机器人有读取/写入数据库的权限
3. **性能考虑**：大量用户时，排行榜查询可能需要优化
4. **数据安全**：不要将数据库文件提交到 Git 仓库

## 🎉 开始使用

1. 启动机器人
2. 在群组中发言测试积分功能
3. 使用 `/points` 查看自己的积分
4. 使用 `/top` 查看排行榜
5. 管理员可以使用积分管理命令奖励成员

享受使用！🚀

