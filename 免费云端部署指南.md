# 🚀 免费云端部署指南

## 📋 目录
1. [Railway 部署（推荐）](#railway-部署推荐)
2. [Render 部署](#render-部署)
3. [Fly.io 部署](#flyio-部署)
4. [Heroku 部署](#heroku-部署)
5. [常见问题](#常见问题)

---

## 🎯 Railway 部署（推荐）

### 优点
- ✅ **完全免费**（每月 $5 免费额度，足够使用）
- ✅ **自动部署**（GitHub 推送自动部署）
- ✅ **简单易用**（图形界面）
- ✅ **支持环境变量**
- ✅ **自动重启**（崩溃自动恢复）

### 步骤

#### 1. 准备代码
确保你的代码已经推送到 GitHub（如果没有，先创建仓库）

#### 2. 注册 Railway
1. 访问 [Railway.app](https://railway.app)
2. 点击 "Login" 使用 GitHub 账号登录
3. 授权 Railway 访问你的 GitHub

#### 3. 创建项目
1. 点击 "New Project"
2. 选择 "Deploy from GitHub repo"
3. 选择你的代码仓库
4. 点击 "Deploy Now"

#### 4. 配置环境变量
1. 在项目页面，点击 "Variables"
2. 添加以下环境变量：
   ```
   BOT_TOKEN=你的机器人Token
   ADMIN_IDS=你的用户ID（可选，多个用逗号分隔）
   ```
3. 点击 "Add" 保存

#### 5. 配置启动命令
1. 在项目页面，点击 "Settings"
2. 找到 "Start Command" 或 "Command"
3. 设置为：`python bot.py`
4. 保存

#### 6. 等待部署
- Railway 会自动检测 `requirements.txt` 并安装依赖
- 部署完成后，机器人会自动运行
- 查看日志：点击 "Deployments" → 选择部署 → "View Logs"

### 费用说明
- **免费额度**：每月 $5
- **使用量**：机器人运行约 $0.01/小时
- **每月可用**：约 500 小时（足够 24/7 运行）

---

## 🌐 Render 部署

### 优点
- ✅ **完全免费**（有免费套餐）
- ✅ **自动部署**
- ✅ **支持环境变量**

### 步骤

#### 1. 注册 Render
1. 访问 [Render.com](https://render.com)
2. 使用 GitHub 账号注册

#### 2. 创建 Web Service
1. 点击 "New" → "Web Service"
2. 连接你的 GitHub 仓库
3. 配置：
   - **Name**: `telegram-bot`
   - **Environment**: `Python 3`
   - **Build Command**: `pip install -r requirements.txt`
   - **Start Command**: `python bot.py`
4. 点击 "Create Web Service"

#### 3. 配置环境变量
1. 在服务页面，点击 "Environment"
2. 添加环境变量：
   ```
   BOT_TOKEN=你的机器人Token
   ADMIN_IDS=你的用户ID
   ```

#### 4. 部署
- Render 会自动部署
- 查看日志：点击 "Logs"

### 免费套餐限制
- **休眠**：15 分钟无活动后休眠
- **唤醒**：首次请求需要等待 30-60 秒
- **适合**：低流量机器人

---

## ✈️ Fly.io 部署

### 优点
- ✅ **完全免费**（有免费额度）
- ✅ **全球 CDN**
- ✅ **快速启动**

### 步骤

#### 1. 安装 Fly CLI
```bash
# Windows (PowerShell)
iwr https://fly.io/install.ps1 -useb | iex

# Mac/Linux
curl -L https://fly.io/install.sh | sh
```

#### 2. 注册账号
```bash
fly auth signup
```

#### 3. 创建应用
```bash
fly launch
```

#### 4. 配置环境变量
```bash
fly secrets set BOT_TOKEN=你的机器人Token
fly secrets set ADMIN_IDS=你的用户ID
```

#### 5. 部署
```bash
fly deploy
```

### 免费额度
- **每月 3 个共享 CPU 虚拟机**
- **160GB 出站流量**
- **足够小型机器人使用**

---

## 🎈 Heroku 部署

### 优点
- ✅ **免费套餐已取消**（需要付费）
- ⚠️ **不推荐**（免费套餐已停止）

### 替代方案
使用 Railway 或 Render（都有免费套餐）

---

## 🔧 部署前准备

### 1. 创建 `.env` 文件（本地测试用）
```env
BOT_TOKEN=你的机器人Token
ADMIN_IDS=你的用户ID
```

### 2. 确保 `requirements.txt` 存在
```txt
python-telegram-bot==20.7
python-dotenv==1.0.0
```

### 3. 确保 `bot.py` 是主程序
```python
if __name__ == '__main__':
    main()
```

### 4. 创建 `Procfile`（Railway 可选）
```
worker: python bot.py
```

---

## 📊 平台对比

| 平台 | 免费额度 | 休眠 | 自动部署 | 推荐度 |
|------|---------|------|---------|--------|
| **Railway** | $5/月 | ❌ | ✅ | ⭐⭐⭐⭐⭐ |
| **Render** | 免费 | ✅ | ✅ | ⭐⭐⭐⭐ |
| **Fly.io** | 3 个 VM | ❌ | ✅ | ⭐⭐⭐⭐ |
| **Heroku** | 无 | - | ✅ | ❌ |

---

## ❓ 常见问题

### Q1: 机器人会一直运行吗？
**A**: 
- **Railway**: ✅ 是的，24/7 运行
- **Render**: ⚠️ 15 分钟无活动会休眠
- **Fly.io**: ✅ 是的，24/7 运行

### Q2: 如何查看日志？
**A**: 
- **Railway**: 项目页面 → "Deployments" → "View Logs"
- **Render**: 服务页面 → "Logs"
- **Fly.io**: `fly logs`

### Q3: 如何更新代码？
**A**: 
- 推送到 GitHub，平台会自动部署
- 或手动触发部署

### Q4: 机器人崩溃了怎么办？
**A**: 
- **Railway**: 自动重启
- **Render**: 自动重启（如果未休眠）
- **Fly.io**: 自动重启

### Q5: 如何停止机器人？
**A**: 
- **Railway**: 项目页面 → "Settings" → "Delete Project"
- **Render**: 服务页面 → "Settings" → "Delete Service"
- **Fly.io**: `fly apps destroy <app-name>`

### Q6: 如何查看机器人状态？
**A**: 
- 在 Telegram 中发送 `/start` 测试
- 查看平台日志确认运行状态

### Q7: 免费额度用完了怎么办？
**A**: 
- **Railway**: 升级到付费计划（$5/月起）
- **Render**: 升级到付费计划（$7/月起）
- **Fly.io**: 升级到付费计划

---

## 🎯 推荐方案

### 最佳选择：Railway
- ✅ 完全免费（$5/月额度）
- ✅ 24/7 运行，不休眠
- ✅ 自动部署，简单易用
- ✅ 图形界面，操作方便

### 备选方案：Render
- ✅ 完全免费
- ⚠️ 会休眠（首次请求慢）
- ✅ 适合低流量机器人

---

## 📝 部署检查清单

- [ ] 代码已推送到 GitHub
- [ ] `requirements.txt` 已创建
- [ ] `bot.py` 是主程序
- [ ] 环境变量已配置（BOT_TOKEN）
- [ ] 部署成功，机器人运行正常
- [ ] 测试 `/start` 命令
- [ ] 查看日志确认无错误

---

## 🚀 快速开始

### Railway（推荐）
1. 访问 [railway.app](https://railway.app)
2. 用 GitHub 登录
3. 创建项目 → 选择仓库
4. 添加环境变量 `BOT_TOKEN`
5. 完成！机器人自动运行

### Render
1. 访问 [render.com](https://render.com)
2. 用 GitHub 登录
3. 创建 Web Service → 选择仓库
4. 配置启动命令：`python bot.py`
5. 添加环境变量
6. 部署完成

---

**🎉 部署完成后，你的机器人将 24/7 运行，无需保持电脑开机！**

